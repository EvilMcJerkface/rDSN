<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>rDSN: Example</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">rDSN
   &#160;<span id="projectnumber">1.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Example<div class="ingroups"><a class="el" href="group__tools.html">Tools</a></div></div>  </div>
</div><!--header-->
<div class="contents">

<p>Build a perfect failure detector with progressively added system complexity.  
<a href="#details">More...</a></p>
<p>Build a perfect failure detector with progressively added system complexity. </p>
<p>Code is <a href="https://github.com/Microsoft/rDSN/tree/master/src/dist/failure_detector">here</a></p>
<p>Detailed tutorial with FD coming later~</p>
<p>This tutorial is to demonstrate how rDSN helps develop and debug a system with progressively added system complexity. You can turn the system complexities using the following toggles in the configuration file. We usually start form very simple scenarios to ensure the basic logic flow working smoothly. We then <b>gradually</b> add system complexity so that when things go wrong, the reasoning space is relatively small. We also change the configurations to see whether a specific error is still present or not, to help guess the root cause.</p>
<p>Single thread versus multiple thread</p>
<p>You can setup thread worker count for each thread pool specifically, usually from 1 to avoid concurrency complexities and bugs initially. Note some of the thread pools may not function correctly when your service uses blocking calls (e.g., <code>task::wait</code>) in the code. In that case, worker count cannot be 1.</p>
<div class="fragment"><div class="line">[threadpool.default]</div><div class="line">worker_count = 1</div><div class="line"></div><div class="line">[threadpool.THREAD_POOL_REPLICATION]</div><div class="line">worker_count = 1</div></div><!-- fragment --><p>Deterministic execution versus non-deterministic execution</p>
<p>A deterministic execution help repeat the same buggy scenario again and again until the whole flow is fixed.</p>
<div class="fragment"><div class="line">[core]</div><div class="line">tool = simulator</div><div class="line"></div><div class="line">[tools.simulator]</div><div class="line">random_seed = 810804960</div><div class="line">use_given_random_seed = <span class="keyword">true</span></div></div><!-- fragment --><p>Non-fault environment versus Fault environment (disk, network)</p>
<p>You can firstly develop our system in a non-faulty environment. After everything seems ok, you can gradually add faults to specific types of tasks, until all of them.</p>
<div class="fragment"><div class="line">[task.default]</div><div class="line">rpc_request_drop_ratio = 0.0</div><div class="line">rpc_response_drop_ratio = 0.05</div><div class="line">disk_read_fail_ratio = 0.0</div><div class="line">disk_write_fail_ratio = 0.0</div><div class="line"></div><div class="line">[task.LPC_REPLICATION_LOGGING]</div><div class="line">disk_read_fail_ratio = 0.001</div><div class="line">disk_write_fail_ratio = 0.01</div></div><!-- fragment --><p>Standalone server versus shared server (resource interference)</p>
<p>Fault injection also provides options about the network, disk, and CPU interference etc.</p>
<div class="fragment"><div class="line">[task.default]</div><div class="line">rpc_message_delay_ms_min = 0</div><div class="line">rpc_message_delay_ms_max = 1000</div><div class="line">disk_io_delay_ms_min = 1</div><div class="line">disk_io_delay_ms_max = 20</div><div class="line">execution_extra_delay_us_max = 0</div><div class="line"></div><div class="line">[task.LPC_GENERATE_THUMBNAIL]</div><div class="line">execution_extra_delay_us_max = 100000</div></div><!-- fragment --><p>Automated exploration of the combinations above</p>
<p>When fault injection is on, and thread number is set to be larger than 1. The system gets enough complexities, and rDSN can help systematically explores the various combinations, including all the faults, message orders, and thread scheduling decisions.</p>
<div class="fragment"><div class="line">[core]</div><div class="line"></div><div class="line">tool = simulator</div><div class="line">;tool = nativerun</div><div class="line">;toollets = tracer</div><div class="line">toollets = fault_injector</div><div class="line">;toollets = tracer, fault_injector</div><div class="line">;toollets = tracer, profiler, fault_injector</div><div class="line">;toollets = profiler, fault_injector</div><div class="line">pause_on_start = false</div><div class="line"></div><div class="line">;logging_factory_name = dsn::tools::screen_logger</div><div class="line"></div><div class="line">[tools.simulator]</div><div class="line">random_seed = 810804960</div><div class="line">use_given_random_seed = <span class="keyword">false</span></div></div><!-- fragment --><p> When things go wrong, you can repeat the bugs. See examples <a href="https://github.com/Microsoft/rDSN/wiki/Tutorial:-Build-A-Single-Node-Counter-Service#step-8-systematic-test-against-various-failures-and-scheduling-decisions">here</a>. </p>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.11
</small></address>
</body>
</html>
